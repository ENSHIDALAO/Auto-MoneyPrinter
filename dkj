-- åˆå§‹æŒ‰é”®ï¼ˆä¿æŒåŸæ ·ï¼‰
game:GetService("VirtualInputManager"):SendKeyEvent(true, "W", false, game)
task.wait(0.01)
game:GetService("VirtualInputManager"):SendKeyEvent(false, "W", false, game)
task.wait(0.01)

-- æœåŠ¡å£°æ˜
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local TextService = game:GetService("TextService")
local UserInputService = game:GetService("UserInputService")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local StarterGui = game:GetService("StarterGui")

-- è·å–æœ¬åœ°ç©å®¶
local LocalPlayer = Players.LocalPlayer

-- åŠ è½½å¿…è¦çš„æ¨¡å—
local devv = require(ReplicatedStorage.devv)
local Signal = devv.load("Signal")
local item = devv.load('v3item')

-- ========================
-- æ•°æ®å­˜å‚¨å’Œæ–‡ä»¶è·¯å¾„é…ç½®
-- ========================
local basePath = "/storage/emulated/0/Delta/Workspace/BENAutoScript"
local serverCountFile = basePath .. "/server_count.txt"
local itemCountFile = basePath .. "/item_count.txt"
local visitedServersFile = basePath .. "/visited_servers.txt"
local executionCountFile = basePath .. "/execution_count.txt"
local moneyPrinterCountFile = basePath .. "/money_printer_count.txt" -- æ–°å¢ï¼šå°é’æœºè®¡æ•°æ–‡ä»¶

-- ç¡®ä¿ç›®å½•å­˜åœ¨
local function ensureDirectory()
    if makefolder and not isfolder then
        pcall(function()
            makefolder(basePath)
        end)
    end
end

-- è¯»å–æ‰§è¡Œæ¬¡æ•°
local function readExecutionCount()
    if not isfile or not readfile then
        return 0
    end
    
    if isfile(executionCountFile) then
        local success, count = pcall(function()
            return tonumber(readfile(executionCountFile)) or 0
        end)
        return success and count or 0
    end
    return 0
end

-- å†™å…¥æ‰§è¡Œæ¬¡æ•°
local function writeExecutionCount(count)
    if not isfile or not writefile then
        return false
    end
    
    local success = pcall(function()
        writefile(executionCountFile, tostring(count))
        return true
    end)
    return success or false
end

-- è¯»å–å°é’æœºè®¡æ•°
local function readMoneyPrinterCount()
    if not isfile or not readfile then
        return 0
    end
    
    if isfile(moneyPrinterCountFile) then
        local success, count = pcall(function()
            return tonumber(readfile(moneyPrinterCountFile)) or 0
        end)
        return success and count or 0
    end
    return 0
end

-- å†™å…¥å°é’æœºè®¡æ•°
local function writeMoneyPrinterCount(count)
    if not isfile or not writefile then
        return false
    end
    
    local success = pcall(function()
        writefile(moneyPrinterCountFile, tostring(count))
        return true
    end)
    return success or false
end

-- æ¸…é™¤å·²è®¿é—®æœåŠ¡å™¨è®°å½•çš„åŠŸèƒ½
local function clearVisitedServers()
    local success = pcall(function()
        if isfile and delfile then
            if isfile(visitedServersFile) then
                delfile(visitedServersFile)
                print("âœ… å·²æ¸…é™¤å·²è®¿é—®æœåŠ¡å™¨è®°å½•")
                return true
            else
                print("âŒ æœªæ‰¾åˆ°å·²è®¿é—®æœåŠ¡å™¨è®°å½•æ–‡ä»¶")
                return false
            end
        else
            print("âŒ æ–‡ä»¶æ“ä½œåŠŸèƒ½ä¸å¯ç”¨")
            return false
        end
    end)
    
    return success or false
end

-- è‡ªåŠ¨æ‰§è¡Œè®¡æ•°é€»è¾‘
local function handleAutoExecution()
    ensureDirectory()
    
    -- è¯»å–å½“å‰æ‰§è¡Œæ¬¡æ•°
    local currentCount = readExecutionCount()
    local newCount = currentCount + 1
    
    print("å½“å‰æ‰§è¡Œæ¬¡æ•°: " .. tostring(currentCount) .. " â†’ " .. tostring(newCount))
    
    -- å†™å…¥æ–°çš„æ‰§è¡Œæ¬¡æ•°
    if writeExecutionCount(newCount) then
        print("âœ… æ‰§è¡Œæ¬¡æ•°è®°å½•æˆåŠŸ")
    else
        print("âŒ æ‰§è¡Œæ¬¡æ•°è®°å½•å¤±è´¥")
    end
    
    -- æ£€æŸ¥æ˜¯å¦éœ€è¦é‡ç½®
    if newCount >= 10 then
        print("ğŸ¯ è¾¾åˆ°10æ¬¡æ‰§è¡Œï¼Œè‡ªåŠ¨é‡ç½®æœåŠ¡å™¨è®°å½•")
        if clearVisitedServers() then
            -- é‡ç½®è®¡æ•°å™¨
            if writeExecutionCount(0) then
                print("âœ… æ‰§è¡Œæ¬¡æ•°å·²é‡ç½®ä¸º0")
            else
                print("âŒ æ‰§è¡Œæ¬¡æ•°é‡ç½®å¤±è´¥")
            end
        else
            print("âŒ æœåŠ¡å™¨è®°å½•æ¸…é™¤å¤±è´¥")
        end
    end
end

-- åˆ›å»ºæ–‡ä»¶å¤¹å­˜å‚¨æ•°æ®
local function setupDataStorage()
    local serverEntries = 0
    local itemDetections = 0
    local moneyPrinterDetections = 0 -- æ–°å¢ï¼šå°é’æœºæ£€æµ‹æ¬¡æ•°
    local visitedServers = {}
    
    local success, result = pcall(function()
        -- æ£€æŸ¥æ˜¯å¦åœ¨ç§»åŠ¨è®¾å¤‡ç¯å¢ƒä¸­
        if not isfolder or not writefile then
            return {serverEntries = 1, itemDetections = 0, moneyPrinterDetections = 0, visitedServers = {}}
        end
        
        -- ç¡®ä¿ç›®å½•å­˜åœ¨
        ensureDirectory()
        
        -- æœåŠ¡å™¨è¿›å…¥æ¬¡æ•°æ–‡ä»¶è·¯å¾„
        if not isfile(serverCountFile) then
            writefile(serverCountFile, "1")
            serverEntries = 1
        else
            local countText = readfile(serverCountFile)
            serverEntries = (tonumber(countText) or 0) + 1
            writefile(serverCountFile, tostring(serverEntries))
        end
        
        -- ç‰©å“æ£€æµ‹æ¬¡æ•°æ–‡ä»¶è·¯å¾„
        if not isfile(itemCountFile) then
            writefile(itemCountFile, "0")
            itemDetections = 0
        else
            local countText = readfile(itemCountFile)
            itemDetections = tonumber(countText) or 0
        end
        
        -- å°é’æœºæ£€æµ‹æ¬¡æ•°æ–‡ä»¶è·¯å¾„
        if not isfile(moneyPrinterCountFile) then
            writefile(moneyPrinterCountFile, "0")
            moneyPrinterDetections = 0
        else
            local countText = readfile(moneyPrinterCountFile)
            moneyPrinterDetections = tonumber(countText) or 0
        end
        
        -- å·²è®¿é—®æœåŠ¡å™¨è®°å½•æ–‡ä»¶è·¯å¾„
        if not isfile(visitedServersFile) then
            writefile(visitedServersFile, "{}")
            visitedServers = {}
        else
            local serversText = readfile(visitedServersFile)
            local success, data = pcall(function()
                return HttpService:JSONDecode(serversText)
            end)
            if success and type(data) == "table" then
                visitedServers = data
            else
                visitedServers = {}
                writefile(visitedServersFile, "{}")
            end
        end
        
        -- è®°å½•å½“å‰æœåŠ¡å™¨ID
        local currentJobId = game.JobId
        if currentJobId and currentJobId ~= "" then
            if not visitedServers[currentJobId] then
                visitedServers[currentJobId] = {
                    firstVisit = os.time(),
                    lastVisit = os.time(),
                    visitCount = 1
                }
            else
                visitedServers[currentJobId].lastVisit = os.time()
                visitedServers[currentJobId].visitCount = (visitedServers[currentJobId].visitCount or 0) + 1
            end
            
            -- ä¿å­˜æ›´æ–°åçš„æœåŠ¡å™¨è®°å½•
            pcall(function()
                writefile(visitedServersFile, HttpService:JSONEncode(visitedServers))
            end)
        end
        
        return {
            serverEntries = serverEntries, 
            itemDetections = itemDetections, 
            moneyPrinterDetections = moneyPrinterDetections,
            visitedServers = visitedServers
        }
    end)
    
    if success then
        return result
    else
        return {serverEntries = 1, itemDetections = 0, moneyPrinterDetections = 0, visitedServers = {}}
    end
end

-- ä¿å­˜ç‰©å“æ£€æµ‹æ¬¡æ•°
local function saveItemDetectionCount(count)
    pcall(function()
        if writefile then
            writefile(itemCountFile, tostring(count))
        end
    end)
end

-- ä¿å­˜å°é’æœºæ£€æµ‹æ¬¡æ•°
local function saveMoneyPrinterCount(count)
    pcall(function()
        if writefile then
            writefile(moneyPrinterCountFile, tostring(count))
        end
    end)
end

-- ä¿å­˜å·²è®¿é—®æœåŠ¡å™¨è®°å½•
local function saveVisitedServers(servers)
    pcall(function()
        if writefile then
            writefile(visitedServersFile, HttpService:JSONEncode(servers))
        end
    end)
end

-- åˆå§‹åŒ–æ•°æ®å’Œè‡ªåŠ¨æ‰§è¡Œè®¡æ•°
local data = setupDataStorage()
local serverEntryCount = data.serverEntries
local itemDetectionCount = data.itemDetections
local moneyPrinterCount = data.moneyPrinterDetections or 0 -- æ–°å¢ï¼šå°é’æœºè®¡æ•°
local visitedServers = data.visitedServers or {}
handleAutoExecution() -- æ‰§è¡Œè‡ªåŠ¨è®¡æ•°é€»è¾‘

-- ========================
-- UI è®¾ç½®
-- ========================
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "BENAutoScriptUI"
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
ScreenGui.ResetOnSpawn = false

-- åˆ›å»ºä¸»å®¹å™¨ï¼ˆå³ä¾§ä¿¡æ¯é¢æ¿ï¼‰- è°ƒæ•´é«˜åº¦ä»¥å®¹çº³æ¸…é™¤æŒ‰é’®
local mainContainer = Instance.new("Frame")
mainContainer.Size = UDim2.new(0, 240, 0, 160) -- é«˜åº¦ä»130å¢åŠ åˆ°160ä»¥å®¹çº³æ¸…é™¤æŒ‰é’®
mainContainer.Position = UDim2.new(1, -250, 0, 10)
mainContainer.AnchorPoint = Vector2.new(0, 0)
mainContainer.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
mainContainer.BackgroundTransparency = 0.3
mainContainer.BorderSizePixel = 0
mainContainer.Parent = ScreenGui

local mainCorner = Instance.new("UICorner")
mainCorner.CornerRadius = UDim.new(0, 12)
mainCorner.Parent = mainContainer

local mainStroke = Instance.new("UIStroke")
mainStroke.Color = Color3.fromRGB(100, 100, 200)
mainStroke.Thickness = 2
mainStroke.Parent = mainContainer

-- æ ‡é¢˜
local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(1, 0, 0, 25)
titleLabel.Position = UDim2.new(0, 0, 0, 0)
titleLabel.BackgroundTransparency = 1
titleLabel.TextColor3 = Color3.fromRGB(100, 200, 255)
titleLabel.Font = Enum.Font.GothamBold
titleLabel.TextSize = 14
titleLabel.Text = "BEN AUTO SCRIPT STATS"
titleLabel.TextXAlignment = Enum.TextXAlignment.Center
titleLabel.TextYAlignment = Enum.TextYAlignment.Center
titleLabel.Parent = mainContainer

-- åˆ†éš”çº¿
local separator = Instance.new("Frame")
separator.Size = UDim2.new(0.9, 0, 0, 1)
separator.Position = UDim2.new(0.05, 0, 0, 25)
separator.BackgroundColor3 = Color3.fromRGB(100, 100, 200)
separator.BorderSizePixel = 0
separator.Parent = mainContainer

-- æœåŠ¡å™¨è®¡æ•°æ˜¾ç¤º
local serverFrame = Instance.new("Frame")
serverFrame.Size = UDim2.new(1, -10, 0, 25)
serverFrame.Position = UDim2.new(0, 5, 0, 30)
serverFrame.BackgroundTransparency = 1
serverFrame.Parent = mainContainer

local serverIcon = Instance.new("TextLabel")
serverIcon.Size = UDim2.new(0, 25, 1, 0)
serverIcon.Position = UDim2.new(0, 0, 0, 0)
serverIcon.BackgroundTransparency = 1
serverIcon.TextColor3 = Color3.fromRGB(100, 200, 100)
serverIcon.Font = Enum.Font.GothamBold
serverIcon.TextSize = 16
serverIcon.Text = "ğŸ”„"
serverIcon.TextXAlignment = Enum.TextXAlignment.Center
serverIcon.TextYAlignment = Enum.TextYAlignment.Center
serverIcon.Parent = serverFrame

local serverLabel = Instance.new("TextLabel")
serverLabel.Size = UDim2.new(1, -30, 1, 0)
serverLabel.Position = UDim2.new(0, 30, 0, 0)
serverLabel.BackgroundTransparency = 1
serverLabel.TextColor3 = Color3.new(1, 1, 1)
serverLabel.Font = Enum.Font.Gotham
serverLabel.TextSize = 14
serverLabel.Text = "æœåŠ¡å™¨è¿›å…¥: " .. serverEntryCount
serverLabel.TextXAlignment = Enum.TextXAlignment.Left
serverLabel.TextYAlignment = Enum.TextYAlignment.Center
serverLabel.Parent = serverFrame

-- ç‰©å“æ£€æµ‹è®¡æ•°æ˜¾ç¤º
local itemFrame = Instance.new("Frame")
itemFrame.Size = UDim2.new(1, -10, 0, 25)
itemFrame.Position = UDim2.new(0, 5, 0, 55)
itemFrame.BackgroundTransparency = 1
itemFrame.Parent = mainContainer

local itemIcon = Instance.new("TextLabel")
itemIcon.Size = UDim2.new(0, 25, 1, 0)
itemIcon.Position = UDim2.new(0, 0, 0, 0)
itemIcon.BackgroundTransparency = 1
itemIcon.TextColor3 = Color3.fromRGB(255, 200, 100)
itemIcon.Font = Enum.Font.GothamBold
itemIcon.TextSize = 16
itemIcon.Text = "ğŸ“¦"
itemIcon.TextXAlignment = Enum.TextXAlignment.Center
itemIcon.TextYAlignment = Enum.TextYAlignment.Center
itemIcon.Parent = itemFrame

local itemLabel = Instance.new("TextLabel")
itemLabel.Size = UDim2.new(1, -30, 1, 0)
itemLabel.Position = UDim2.new(0, 30, 0, 0)
itemLabel.BackgroundTransparency = 1
itemLabel.TextColor3 = Color3.new(1, 1, 1)
itemLabel.Font = Enum.Font.Gotham
itemLabel.TextSize = 14
itemLabel.Text = "ç‰©å“æ£€æµ‹: " .. itemDetectionCount
itemLabel.TextXAlignment = Enum.TextXAlignment.Left
itemLabel.TextYAlignment = Enum.TextYAlignment.Center
itemLabel.Parent = itemFrame

-- å°é’æœºæ£€æµ‹è®¡æ•°æ˜¾ç¤º
local printerFrame = Instance.new("Frame")
printerFrame.Size = UDim2.new(1, -10, 0, 25)
printerFrame.Position = UDim2.new(0, 5, 0, 80)
printerFrame.BackgroundTransparency = 1
printerFrame.Parent = mainContainer

local printerIcon = Instance.new("TextLabel")
printerIcon.Size = UDim2.new(0, 25, 1, 0)
printerIcon.Position = UDim2.new(0, 0, 0, 0)
printerIcon.BackgroundTransparency = 1
printerIcon.TextColor3 = Color3.fromRGB(100, 255, 100)
printerIcon.Font = Enum.Font.GothamBold
printerIcon.TextSize = 16
printerIcon.Text = "ğŸ’°"
printerIcon.TextXAlignment = Enum.TextXAlignment.Center
printerIcon.TextYAlignment = Enum.TextYAlignment.Center
printerIcon.Parent = printerFrame

local printerLabel = Instance.new("TextLabel")
printerLabel.Size = UDim2.new(1, -30, 1, 0)
printerLabel.Position = UDim2.new(0, 30, 0, 0)
printerLabel.BackgroundTransparency = 1
printerLabel.TextColor3 = Color3.new(1, 1, 1)
printerLabel.Font = Enum.Font.Gotham
printerLabel.TextSize = 14
printerLabel.Text = "å°é’æœºæ£€æµ‹: " .. moneyPrinterCount
printerLabel.TextXAlignment = Enum.TextXAlignment.Left
printerLabel.TextYAlignment = Enum.TextYAlignment.Center
printerLabel.Parent = printerFrame

-- å·²è®¿é—®æœåŠ¡å™¨è®¡æ•°æ˜¾ç¤º
local visitedFrame = Instance.new("Frame")
visitedFrame.Size = UDim2.new(1, -10, 0, 25)
visitedFrame.Position = UDim2.new(0, 5, 0, 105)
visitedFrame.BackgroundTransparency = 1
visitedFrame.Parent = mainContainer

local visitedIcon = Instance.new("TextLabel")
visitedIcon.Size = UDim2.new(0, 25, 1, 0)
visitedIcon.Position = UDim2.new(0, 0, 0, 0)
visitedIcon.BackgroundTransparency = 1
visitedIcon.TextColor3 = Color3.fromRGB(200, 100, 255)
visitedIcon.Font = Enum.Font.GothamBold
visitedIcon.TextSize = 16
visitedIcon.Text = "ğŸ“Š"
visitedIcon.TextXAlignment = Enum.TextXAlignment.Center
visitedIcon.TextYAlignment = Enum.TextYAlignment.Center
visitedIcon.Parent = visitedFrame

local visitedLabel = Instance.new("TextLabel")
visitedLabel.Size = UDim2.new(1, -30, 1, 0)
visitedLabel.Position = UDim2.new(0, 30, 0, 0)
visitedLabel.BackgroundTransparency = 1
visitedLabel.TextColor3 = Color3.new(1, 1, 1)
visitedLabel.Font = Enum.Font.Gotham
visitedLabel.TextSize = 14
visitedLabel.Text = "å·²è®¿é—®æœåŠ¡å™¨: " .. (#visitedServers > 0 and table.getn(visitedServers) or 0)
visitedLabel.TextXAlignment = Enum.TextXAlignment.Left
visitedLabel.TextYAlignment = Enum.TextYAlignment.Center
visitedLabel.Parent = visitedFrame

-- æ¸…é™¤æœåŠ¡å™¨è®°å½•æŒ‰é’®ï¼ˆç§»åŠ¨åˆ°ä¸»UIå†…ï¼‰
local clearButton = Instance.new("TextButton")
clearButton.Size = UDim2.new(0.9, 0, 0, 25)
clearButton.Position = UDim2.new(0.05, 0, 0, 130)
clearButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
clearButton.BackgroundTransparency = 0.2
clearButton.TextColor3 = Color3.new(1, 1, 1)
clearButton.Font = Enum.Font.GothamBold
clearButton.TextSize = 12
clearButton.Text = "æ¸…é™¤æœåŠ¡å™¨è®°å½•"
clearButton.Parent = mainContainer

local clearButtonCorner = Instance.new("UICorner")
clearButtonCorner.CornerRadius = UDim.new(0, 6)
clearButtonCorner.Parent = clearButton

local clearButtonStroke = Instance.new("UIStroke")
clearButtonStroke.Color = Color3.fromRGB(255, 100, 100)
clearButtonStroke.Thickness = 1
clearButtonStroke.Parent = clearButton

-- æ˜¾ç¤ºæ‰§è¡Œæ¬¡æ•°çš„æ ‡ç­¾ï¼ˆæ”¾åœ¨æ¸…é™¤æŒ‰é’®ä¸‹æ–¹ï¼‰
local countLabel = Instance.new("TextLabel")
countLabel.Size = UDim2.new(1, -10, 0, 15)
countLabel.Position = UDim2.new(0, 5, 0, 158)
countLabel.BackgroundTransparency = 1
countLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
countLabel.Font = Enum.Font.Gotham
countLabel.TextSize = 10
countLabel.Text = "è®¡æ•°: åŠ è½½ä¸­..."
countLabel.TextXAlignment = Enum.TextXAlignment.Center
countLabel.Parent = mainContainer

-- æ›´æ–°ç‰©å“æ£€æµ‹æ˜¾ç¤º
local function updateItemDetectionDisplay()
    itemLabel.Text = "ç‰©å“æ£€æµ‹: " .. itemDetectionCount
end

-- æ›´æ–°å°é’æœºæ£€æµ‹æ˜¾ç¤º
local function updateMoneyPrinterDisplay()
    printerLabel.Text = "å°é’æœºæ£€æµ‹: " .. moneyPrinterCount
end

-- æ›´æ–°å·²è®¿é—®æœåŠ¡å™¨æ˜¾ç¤º
local function updateVisitedServersDisplay()
    local count = 0
    for _ in pairs(visitedServers) do
        count = count + 1
    end
    visitedLabel.Text = "å·²è®¿é—®æœåŠ¡å™¨: " .. count
end

-- æ›´æ–°è®¡æ•°æ˜¾ç¤º
local function updateCountDisplay()
    local currentCount = readExecutionCount()
    countLabel.Text = "è®¡æ•°: " .. tostring(currentCount) .. "/10"
end

-- æŒ‰é’®ç‚¹å‡»æ•ˆæœ
clearButton.MouseEnter:Connect(function()
    TweenService:Create(clearButton, TweenInfo.new(0.2), {BackgroundTransparency = 0}):Play()
end)

clearButton.MouseLeave:Connect(function()
    TweenService:Create(clearButton, TweenInfo.new(0.2), {BackgroundTransparency = 0.2}):Play()
end)

-- æŒ‰é’®ç‚¹å‡»äº‹ä»¶
clearButton.MouseButton1Click:Connect(function()
    local success = clearVisitedServers()
    
    -- æ˜¾ç¤ºæ“ä½œç»“æœ
    local resultLabel = Instance.new("TextLabel")
    resultLabel.Size = UDim2.new(1, -10, 0, 15)
    resultLabel.Position = UDim2.new(0, 5, 0, 158)
    resultLabel.BackgroundTransparency = 1
    resultLabel.Font = Enum.Font.Gotham
    resultLabel.TextSize = 10
    resultLabel.TextXAlignment = Enum.TextXAlignment.Center
    resultLabel.Parent = mainContainer
    
    if success then
        resultLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
        resultLabel.Text = "âœ… æ¸…é™¤æˆåŠŸ!"
        -- é‡ç½®å·²è®¿é—®æœåŠ¡å™¨æ•°æ®
        visitedServers = {}
        updateVisitedServersDisplay()
    else
        resultLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
        resultLabel.Text = "âŒ æ¸…é™¤å¤±è´¥"
    end
    
    -- 3ç§’åæ¢å¤æ˜¾ç¤ºè®¡æ•°
    wait(3)
    resultLabel:Destroy()
    updateCountDisplay()
end)

-- ä¸­é—´æ¬¢è¿æ–‡å­—
local welcomeContainer = Instance.new("Frame")
welcomeContainer.Size = UDim2.new(0, 0, 0, 50)
welcomeContainer.Position = UDim2.new(0.5, 0, 0.4, 0)
welcomeContainer.AnchorPoint = Vector2.new(0.5, 0.5)
welcomeContainer.BackgroundTransparency = 1
welcomeContainer.ClipsDescendants = true
welcomeContainer.Parent = ScreenGui

local welcomeLabel = Instance.new("TextLabel")
welcomeLabel.Size = UDim2.new(1, 0, 1, 0)
welcomeLabel.Position = UDim2.new(0, 0, 0, 0)
welcomeLabel.BackgroundTransparency = 1
welcomeLabel.TextColor3 = Color3.new(1, 1, 1)
welcomeLabel.Font = Enum.Font.GothamBold
welcomeLabel.TextSize = 36
welcomeLabel.Text = "BEN AUTO SCRIPT"
welcomeLabel.TextXAlignment = Enum.TextXAlignment.Left
welcomeLabel.TextYAlignment = Enum.TextYAlignment.Center
welcomeLabel.Parent = welcomeContainer

-- ä»å·¦åˆ°å³æ¸æ˜¾åŠ¨ç”»
task.spawn(function()
    local textService = game:GetService("TextService")
    local textSize = textService:GetTextSize("BEN AUTO SCRIPT", 36, Enum.Font.GothamBold, Vector2.new(1000, 50))
    
    -- å±•å¼€åŠ¨ç”»
    for i = 1, 20 do
        welcomeContainer.Size = UDim2.new(0, textSize.X * (i / 20), 0, 50)
        task.wait(0.02)
    end
    
    welcomeContainer.Size = UDim2.new(0, textSize.X, 0, 50)
    
    -- æ˜¾ç¤º5ç§’åæ·¡å‡º
    task.wait(5)
    
    -- æ·¡å‡ºåŠ¨ç”»
    for i = 1, 10 do
        welcomeLabel.TextTransparency = i / 10
        task.wait(0.1)
    end
    welcomeContainer:Destroy()
end)

-- ========================
-- è‡ªåŠ¨å”®å–åŠŸèƒ½
-- ========================
local function autoSellOnce()
    local itemsToSell = {
        'Amethyst', 'Sapphire', 'Emerald', 'Topaz', 'Ruby', 
        'Diamond Ring', "Gold Bar", "AK-47", "AR-15", "Diamond"
    }
    
    local soldCount = 0
    
    pcall(function()
        if not LocalPlayer.Character or not LocalPlayer.Character:FindFirstChild("Humanoid") then
            return
        end
        
        local inventory = item.inventory
        if not inventory or not inventory.items then
            return
        end
        
        for i, v in next, inventory.items do
            for _, itemName in ipairs(itemsToSell) do
                if v.name == itemName then
                    local sellid = v.guid
                    
                    Signal.FireServer("equip", sellid)
                    Signal.FireServer("sellItem", sellid)
                    
                    soldCount = soldCount + 1
                    task.wait(0.3)
                    break
                end
            end
        end
        
        if soldCount > 0 then
            -- å”®å–æˆåŠŸï¼Œå¯ä»¥æ·»åŠ æç¤º
        else
            -- æ²¡æœ‰ç‰©å“å¯å”®å–
        end
    end)
end

-- ========================
-- æˆ˜æ–—åŠŸèƒ½
-- ========================
local autokill = true
local autojia = true
local autostomp = true
local hitMOD = "meleemegapunch"
local jiahit = "Light Vest"

local function getFistsGUID()
    for _, v in pairs(item.inventory.items) do
        if v.name == 'Fists' then
            return v.guid
        end
    end
    return nil
end

local qtid = getFistsGUID()

-- æˆ˜æ–—ä¸»å¾ªç¯
RunService.Heartbeat:Connect(function()
    pcall(function()
        local character = LocalPlayer.Character
        if not character then return end
        
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        local rootPart = character:FindFirstChild("HumanoidRootPart")
        if not humanoid or not rootPart or humanoid.Health <= 0 then return end

        -- è‡ªåŠ¨ç©¿ç”²
        if autojia then
            Signal.InvokeServer("attemptPurchase", jiahit)
            for i, v in next, item.inventory.items do
                if v.name == jiahit then
                    local light = v.guid
                    local armor = LocalPlayer:GetAttribute('armor')
                    if armor == nil or armor <= 0 then
                        Signal.FireServer("equip", light)
                        Signal.FireServer("useConsumable", light)
                        Signal.FireServer("removeItem", light)
                        break
                    end
                end
            end
        end

        -- æ€æˆ®å…‰ç¯
        if autokill and qtid then
            for _, player in ipairs(Players:GetPlayers()) do
                if player ~= LocalPlayer and player.Character then
                    local targetChar = player.Character
                    local targetHRP = targetChar:FindFirstChild("HumanoidRootPart")
                    local targetHumanoid = targetChar:FindFirstChildOfClass("Humanoid")
                    
                    if targetHRP and targetHumanoid and targetHumanoid.Health > 0 then
                        local distance = (rootPart.Position - targetHRP.Position).Magnitude
                        
                        if distance <= 40 then
                            local uid = player.UserId
                            
                            Signal.FireServer("equip", qtid)
                            Signal.FireServer("meleeItemHit", "player", { 
                                hitPlayerId = uid, 
                                meleeType = hitMOD 
                            })
                            
                            break
                        end
                    end
                end
            end
        end

        -- è¸©è¸å…‰ç¯
        if autostomp then
            for _, player in ipairs(Players:GetPlayers()) do
                if player ~= LocalPlayer and player.Character then
                    local targetChar = player.Character
                    local targetHRP = targetChar:FindFirstChild("HumanoidRootPart")
                    local targetHumanoid = targetChar:FindFirstChildOfClass("Humanoid")
                    
                    if targetHRP and targetHumanoid and targetHumanoid.Health < 20 then
                        local distance = (rootPart.Position - targetHRP.Position).Magnitude
                        
                        if distance <= 40 then
                            Signal.FireServer("stomp", player)
                            break
                        end
                    end
                end
            end
        end
    end)
end)

-- ç›‘å¬è§’è‰²é‡ç”Ÿ
local function onCharacterAdded(character)
    character:WaitForChild("Humanoid")
    character:WaitForChild("HumanoidRootPart")
    qtid = getFistsGUID()
    autoSellOnce() -- è§’è‰²é‡ç”Ÿæ—¶è‡ªåŠ¨å”®å–
end

if LocalPlayer.Character then
    onCharacterAdded(LocalPlayer.Character)
else
    LocalPlayer.CharacterAdded:Connect(onCharacterAdded)
end

-- ========================
-- ç‰©å“æ”¶é›†ä¸æœåŠ¡å™¨è·³è½¬
-- ========================
local forbiddenZoneCenter = Vector3.new(352.884155, 13.0287256, -1353.05396)
local forbiddenRadius = 80
local currentJobId = game.JobId

local targetItems = { 
    "Money Printer", "Blue Candy Cane", "Bunny Balloon", "Ghost Balloon", 
    "Clover Balloon", "Bat Balloon", "Gold Clover Balloon", "Golden Rose", 
    "Black Rose", "Heart Balloon", "Dafy Money Printor", "NextBot Grenade", 
    "Military Armory Keycard", "Trident", "Helicopter", "Diamond Ring", 
    "Diamond", "Void Gem", "Dark Matter Gem", "Rollie", "Nuclear Missile Launcher",
    "Suitcase Nuke", "Trident", "Golden Cup"
}

-- å¢åŠ ç‰©å“æ£€æµ‹è®¡æ•°
local function incrementItemDetection()
    itemDetectionCount = itemDetectionCount + 1
    saveItemDetectionCount(itemDetectionCount)
    updateItemDetectionDisplay()
    print("æ£€æµ‹åˆ°ç›®æ ‡ç‰©å“ï¼Œæ€»æ£€æµ‹æ¬¡æ•°: " .. itemDetectionCount)
end

-- å¢åŠ å°é’æœºæ£€æµ‹è®¡æ•°
local function incrementMoneyPrinterDetection()
    moneyPrinterCount = moneyPrinterCount + 1
    saveMoneyPrinterCount(moneyPrinterCount)
    updateMoneyPrinterDisplay()
    print("ğŸ’° æ£€æµ‹åˆ°å°é’æœº! æ€»å°é’æœºæ£€æµ‹æ¬¡æ•°: " .. moneyPrinterCount)
end

-- æœåŠ¡å™¨è·³è½¬åŠŸèƒ½ï¼ˆæ’é™¤å·²è®¿é—®çš„æœåŠ¡å™¨ï¼‰
local function TPServer()
    local success, servers = pcall(function()
        return HttpService:JSONDecode(game:HttpGet(
            "https://games.roblox.com/v1/games/"..game.PlaceId.."/servers/Public?limit=100"))
    end)
    
    if not success then
        task.wait(1)
        TPServer()
        return
    end
    
    local availableServers = {}
    
    for _, server in ipairs(servers.data) do
        -- æ’é™¤å·²è®¿é—®çš„æœåŠ¡å™¨å’Œå½“å‰æœåŠ¡å™¨
        if server.playing < server.maxPlayers and server.id ~= currentJobId and not visitedServers[server.id] then
            table.insert(availableServers, {
                id = server.id,
                players = server.playing,
                maxPlayers = server.maxPlayers
            })
        end
    end
    
    if #availableServers > 0 then
        table.sort(availableServers, function(a, b)
            return a.players < b.players
        end)
        
        local bestServers = {}
        local quarterIndex = math.max(1, math.floor(#availableServers * 0.25))
        
        for i = 1, quarterIndex do
            table.insert(bestServers, availableServers[i].id)
        end
        
        if #bestServers > 0 then
            local selectedServer = bestServers[math.random(1, #bestServers)]
            TeleportService:TeleportToPlaceInstance(game.PlaceId, selectedServer)
        else
            local randomServer = availableServers[math.random(1, #availableServers)].id
            TeleportService:TeleportToPlaceInstance(game.PlaceId, randomServer)
        end
    else
        -- å¦‚æœæ²¡æœ‰å¯ç”¨çš„æ–°æœåŠ¡å™¨ï¼Œéšæœºé€‰æ‹©ä¸€ä¸ªå·²è®¿é—®çš„æœåŠ¡å™¨
        local visitedServerIds = {}
        for serverId in pairs(visitedServers) do
            if serverId ~= currentJobId then
                table.insert(visitedServerIds, serverId)
            end
        end
        
        if #visitedServerIds > 0 then
            local randomVisitedServer = visitedServerIds[math.random(1, #visitedServerIds)]
            TeleportService:TeleportToPlaceInstance(game.PlaceId, randomVisitedServer)
        else
            task.wait(0.5)
            TPServer()
        end
    end
end

-- ç‰©å“æ£€æµ‹
local function FindTargetItems()
    local foundItems = {}
    local startTime = os.clock()
    
    for _, itemFolder in pairs(game:GetService("Workspace").Game.Entities.ItemPickup:GetChildren()) do
        for _, item in pairs(itemFolder:GetChildren()) do
            if (item:IsA("MeshPart") or item:IsA("Part")) and os.clock() - startTime < 0.5 then
                local itemPos = item.Position
                local distance = (itemPos - forbiddenZoneCenter).Magnitude
                
                if distance > forbiddenRadius then
                    local prompt = item:FindFirstChildOfClass("ProximityPrompt")
                    if prompt and table.find(targetItems, prompt.ObjectText) then
                        -- å¢åŠ ç‰©å“æ£€æµ‹è®¡æ•°
                        incrementItemDetection()
                        
                        -- å¦‚æœæ˜¯å°é’æœºï¼Œå¢åŠ å°é’æœºè®¡æ•°
                        if prompt.ObjectText == "Money Printer" or prompt.ObjectText == "Dafy Money Printor" then
                            incrementMoneyPrinterDetection()
                        end
                        
                        table.insert(foundItems, {
                            item = item,
                            prompt = prompt,
                            distance = (itemPos - (LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") and LocalPlayer.Character.HumanoidRootPart.Position or Vector3.new())).Magnitude
                        })
                    end
                end
            end
        end
    end
    
    table.sort(foundItems, function(a, b)
        return a.distance < b.distance
    end)
    
    return foundItems
end

-- ç‰©å“æ”¶é›†
local function PickItem(item, prompt)
    local startTime = tick()
    local timeout = 3
    local itemCollected = false
    local shouldSwitchServer = false
    
    if not item or not prompt then return false end
    
    prompt.RequiresLineOfSight = false
    prompt.HoldDuration = 0
    
    local eKeyLoop = coroutine.create(function()
        while not itemCollected and item and item.Parent and tick() - startTime < timeout do
            VirtualInputManager:SendKeyEvent(true, "E", false, game)
            task.wait(0.01)
            VirtualInputManager:SendKeyEvent(false, "E", false, game)
            task.wait(0.01)
        end
    end)
    
    coroutine.resume(eKeyLoop)
    
    local connection
    connection = RunService.Heartbeat:Connect(function()
        if not item or not item.Parent then
            itemCollected = true
            if connection then connection:Disconnect() end
            return
        end
        
        if tick() - startTime >= timeout then
            shouldSwitchServer = true
            if connection then connection:Disconnect() end
            return
        end
        
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
            LocalPlayer.Character.HumanoidRootPart.CFrame = item.CFrame * CFrame.new(0, 2, 0)
        end
        fireproximityprompt(prompt)
    end)
    
    repeat 
        task.wait(0.1) 
    until itemCollected or not item or not item.Parent or tick() - startTime >= timeout
    
    if connection then
        connection:Disconnect()
    end
    
    if shouldSwitchServer then
        TPServer()
    end
    
    return itemCollected
end

-- è‡ªåŠ¨æŒ‰EåŠŸèƒ½
local function autoPressE()
    while true do
        VirtualInputManager:SendKeyEvent(true, "E", false, game)
        task.wait(0.01)
        VirtualInputManager:SendKeyEvent(false, "E", false, game)
        task.wait(0.01)
    end
end

-- å¯åŠ¨è‡ªåŠ¨æŒ‰E
coroutine.wrap(autoPressE)()

-- ä¸»å¾ªç¯
coroutine.wrap(function()
    while true do
        local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
        local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
        local humanoid = character:WaitForChild("Humanoid")
        
        local items = FindTargetItems()
        if #items > 0 then
            for _, itemData in ipairs(items) do
                if PickItem(itemData.item, itemData.prompt) then
                    break
                end
            end
        else
            TPServer()
        end
        
        task.wait(0.1)
    end
end)()

-- æ›´æ–°UIæ˜¾ç¤º
updateVisitedServersDisplay()
updateCountDisplay()

print("BEN Auto Script å·²å®Œå…¨åŠ è½½ï¼")
print("æ‰§è¡Œè®¡æ•°æ–‡ä»¶: " .. executionCountFile)
print("æœåŠ¡å™¨è®°å½•æ–‡ä»¶: " .. visitedServersFile)
print("å°é’æœºè®¡æ•°æ–‡ä»¶: " .. moneyPrinterCountFile)
print("å½“å‰å°é’æœºæ£€æµ‹æ¬¡æ•°: " .. moneyPrinterCount)
